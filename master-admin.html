<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MasterAdmin | Enterprise Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBcp0fkuwhOOyO7fgAlbCoftWwkuog-vwQ",
            authDomain: "quickcv-47c99.firebaseapp.com",
            projectId: "quickcv-47c99",
            storageBucket: "quickcv-47c99.firebasestorage.app",
            messagingSenderId: "541347686112",
            appId: "1:541347686112:web:b821dd7213ab8674959285"
        };

        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.auth = getAuth(app);

        // Real-time listener for "Money & Usage Control"
        const creditRef = doc(window.db, "system", "credits");
        onSnapshot(creditRef, (doc) => {
            if (doc.exists()) {
                const data = doc.data();
                AppState.credits.used = data.used || 0;
                AppState.credits.total = data.total || 10000;
                updateCreditUI();
            }
        });
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --primary: #2563eb;
            --success: #5d9e72;
            --danger: #e35d5d;
            --sidebar-bg: #ffffff;
            --main-bg: #f4f7fa;
        }

        body {
            background-color: var(--main-bg);
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: #1e293b;
            overflow: hidden;
        }

        .glass-panel {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-radius: 1.25rem;
        }

        .sidebar-link {
            transition: all 0.2s ease;
            border-radius: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .sidebar-link.active {
            background: #1e3a8a;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(30, 58, 138, 0.3);
        }

        .stat-card-green { background: var(--success); color: white; }
        .stat-card-blue { background: #3b5998; color: white; }
        .stat-card-white { background: white; border-top: 4px solid var(--primary); }
        .stat-card-red { background: var(--danger); color: white; }

        .progress-container {
            height: 10px;
            background: #e2e8f0;
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 1.5s ease-in-out;
        }

        .live-pulse {
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse-ring {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .custom-toggle {
            width: 38px;
            height: 20px;
            background: #cbd5e1;
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
        }
        .custom-toggle.active { background: var(--success); }
        .toggle-circle {
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 3px;
            left: 3px;
            transition: 0.3s;
        }
        .custom-toggle.active .toggle-circle { transform: translateX(18px); }

        main { height: 100vh; overflow-y: auto; scroll-behavior: smooth; }
    </style>
</head>
<body class="flex">

    <aside class="w-72 bg-white h-screen flex flex-col p-6 border-r border-slate-200 z-50">
        <div class="mb-10 px-2">
            <h1 class="text-2xl font-extrabold tracking-tighter text-slate-800">MASTER<span class="text-blue-600">ADMIN</span></h1>
            <p class="text-[10px] font-bold text-slate-400 tracking-widest uppercase">Enterprise Command</p>
        </div>

        <nav class="flex-1 space-y-1">
            <a href="#" onclick="switchTab('dashboard')" id="nav-dashboard" class="sidebar-link active flex items-center gap-4 p-4 font-bold text-sm">
                <i class="fas fa-chart-pie w-5"></i> Dashboard
            </a>
            <a href="#" onclick="switchTab('admins')" id="nav-admins" class="sidebar-link flex items-center gap-4 p-4 font-bold text-sm text-slate-500 hover:bg-slate-50">
                <i class="fas fa-user-shield w-5"></i> Admin Seats
            </a>
            <a href="#" onclick="switchTab('tank')" id="nav-tank" class="sidebar-link flex items-center gap-4 p-4 font-bold text-sm text-slate-500 hover:bg-slate-50">
                <i class="fas fa-database w-5"></i> Holding Tank
            </a>
            <a href="#" onclick="switchTab('credits')" id="nav-credits" class="sidebar-link flex items-center gap-4 p-4 font-bold text-sm text-slate-500 hover:bg-slate-50">
                <i class="fas fa-credit-card w-5"></i> CV Credits
            </a>
        </nav>

        <div class="mt-auto bg-slate-50 rounded-2xl p-4 border border-slate-100">
            <div class="flex items-center gap-3 mb-3">
                <div class="w-2 h-2 rounded-full bg-emerald-500 live-pulse"></div>
                <span class="text-[10px] font-black uppercase text-slate-400">System Status: Online</span>
            </div>
            <button onclick="systemLogout()" class="w-full bg-white border border-red-100 text-red-500 py-3 rounded-xl text-xs font-bold hover:bg-red-50 transition">
                <i class="fas fa-sign-out-alt mr-2"></i> Terminate Session
            </button>
        </div>
    </aside>

    <main class="flex-1 p-8">
        
        <header class="flex justify-between items-center mb-8">
            <div>
                <h2 id="view-title" class="text-3xl font-black text-slate-800 tracking-tight">Executive Dashboard</h2>
                <p id="view-subtitle" class="text-slate-400 font-medium">Real-time system integrity and performance metrics.</p>
            </div>
            <div class="flex gap-4">
                <div class="bg-white px-5 py-2 rounded-xl border border-slate-200 text-right">
                    <p class="text-[9px] font-bold text-slate-400 uppercase">Current Tier</p>
                    <p class="text-xs font-black text-blue-600">UNLIMITED ENTERPRISE</p>
                </div>
                <button class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm shadow-lg shadow-blue-200 hover:bg-blue-700 transition">
                    + New Task
                </button>
            </div>
        </header>

        <div id="view-dashboard" class="space-y-8 animate-in fade-in duration-500">
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="stat-card-green p-6 rounded-2xl flex justify-between items-start shadow-lg">
                    <div>
                        <p class="text-xs font-bold uppercase opacity-80">Active Admins</p>
                        <h3 class="text-4xl font-black mt-1" id="stat-active-admins">0</h3>
                        <p class="text-[10px] mt-2 font-medium">Across 12 Global Locations</p>
                    </div>
                    <i class="fas fa-users-cog text-3xl opacity-30"></i>
                </div>
                <div class="stat-card-blue p-6 rounded-2xl flex justify-between items-start shadow-lg">
                    <div>
                        <p class="text-xs font-bold uppercase opacity-80">Total CVs Processed</p>
                        <h3 class="text-4xl font-black mt-1">12,842</h3>
                        <p class="text-[10px] mt-2 font-medium">Efficiency +18% vs Last Week</p>
                    </div>
                    <i class="fas fa-microchip text-3xl opacity-30"></i>
                </div>
                <div class="stat-card-white p-6 rounded-2xl flex justify-between items-start glass-panel">
                    <div>
                        <p class="text-xs font-bold uppercase text-slate-400">System Alerts</p>
                        <h3 class="text-4xl font-black mt-1 text-slate-800">3,570</h3>
                        <div class="w-24 h-1.5 bg-slate-100 mt-3 rounded-full overflow-hidden">
                            <div class="bg-blue-500 h-full w-[65%]"></div>
                        </div>
                    </div>
                    <i class="fas fa-bolt text-3xl text-slate-100"></i>
                </div>
                <div class="stat-card-red p-6 rounded-2xl flex justify-between items-start shadow-lg">
                    <div>
                        <p class="text-xs font-bold uppercase opacity-80">Critical Issues</p>
                        <h3 class="text-4xl font-black mt-1">2 <span class="text-lg font-normal">Errors</span></h3>
                        <p class="text-[10px] mt-2 font-medium">Action Required Immediately</p>
                    </div>
                    <i class="fas fa-triangle-exclamation text-3xl opacity-30"></i>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <div class="lg:col-span-5 space-y-6">
                    <div class="glass-panel p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-slate-700 uppercase text-sm tracking-widest">Seat Management</h3>
                            <button onclick="openModal('adminModal')" class="bg-blue-50 text-blue-600 text-[10px] px-3 py-2 rounded-lg font-black uppercase">+ Provision</button>
                        </div>
                        
                        <div class="space-y-1" id="admin-render-area">
                        </div>
                    </div>

                    <div class="glass-panel p-6">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm uppercase tracking-widest">Data Inflow</h3>
                        <div class="flex gap-2 mb-4">
                            <button class="bg-slate-800 text-white text-[10px] px-4 py-2 rounded-lg font-bold">HOLDING TANK</button>
                            <button class="bg-slate-100 text-slate-500 text-[10px] px-4 py-2 rounded-lg font-bold">ASSIGNED</button>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-sm font-black text-slate-700">78 Unassigned CVs</p>
                                <p class="text-[10px] text-slate-400 font-bold uppercase">Awaiting admin routing</p>
                            </div>
                            <button class="bg-blue-600 text-white p-3 rounded-lg"><i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-7 space-y-6">
                    <div class="glass-panel p-8">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h3 class="font-black text-slate-800 text-lg uppercase">Credit Utilization</h3>
                                <p class="text-xs text-slate-400">Total volume limit for current billing cycle</p>
                            </div>
                            <span class="bg-amber-100 text-amber-700 text-[10px] px-3 py-1 rounded-full font-black uppercase">Low Credit Alert</span>
                        </div>

                        <div class="relative pt-4 pb-2">
                            <div class="progress-container">
                                <div class="progress-fill" id="credit-bar" style="width: 0%;"></div>
                            </div>
                            <div class="flex justify-between mt-3 text-[10px] font-black text-slate-500 uppercase tracking-tighter">
                                <span id="credits-left-text">0 Credits Remaining</span>
                                <span>10,000 Cap</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-6 mt-6">
                            <div class="p-4 bg-slate-50 rounded-xl">
                                <p class="text-[10px] font-bold text-slate-400 uppercase">Purchased</p>
                                <p class="text-xl font-black text-slate-800">10,000</p>
                            </div>
                            <div class="p-4 bg-slate-50 rounded-xl text-right">
                                <p class="text-[10px] font-bold text-slate-400 uppercase">Consumed</p>
                                <p class="text-xl font-black text-slate-800" id="credits-used-text">6,430</p>
                            </div>
                        </div>

                        <button class="w-full bg-emerald-600 text-white mt-8 py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex justify-between px-8 items-center hover:bg-emerald-700 shadow-xl shadow-emerald-100 transition-all active:scale-95">
                            Recharge Credit Pool <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <div class="glass-panel p-6">
                        <h3 class="font-bold text-slate-700 mb-6 text-sm uppercase tracking-widest">Admin Performance Matrix</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="text-[10px] font-black text-slate-400 uppercase border-b border-slate-50">
                                        <th class="pb-4">Operator</th>
                                        <th class="pb-4 text-center">Volume</th>
                                        <th class="pb-4 text-right">Accuracy</th>
                                    </tr>
                                </thead>
                                <tbody id="performance-render-area">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="adminModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] w-full max-w-md p-10 shadow-2xl">
            <h3 class="text-2xl font-black text-slate-800 mb-2">New Seat Authorization</h3>
            <p class="text-sm text-slate-500 mb-8">Provision a new admin access token for the system.</p>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-1">Email Address</label>
                    <input type="email" id="newAdminEmail" placeholder="admin@enterprise.com" class="w-full bg-slate-50 border border-slate-200 p-4 rounded-xl font-bold outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-1">Access Level</label>
                    <select id="newAdminLevel" class="w-full bg-slate-50 border border-slate-200 p-4 rounded-xl font-bold outline-none">
                        <option>Standard Reviewer</option>
                        <option>Quality Assurance</option>
                        <option>Regional Manager</option>
                    </select>
                </div>
                <div class="flex gap-4 pt-6">
                    <button onclick="closeModal('adminModal')" class="flex-1 py-4 font-bold text-slate-400 text-sm">Cancel</button>
                    <button onclick="provisionSeat()" class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-black text-xs uppercase tracking-widest">Generate Seat</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const AppState = {
            admins: [
                { id: 1, name: "Jake Thompson", email: "jake@ops.io", status: "Active", toggle: true, processed: 102, score: "92%" },
                { id: 2, name: "Maria Patel", email: "maria@ops.io", status: "Active", toggle: true, processed: 56, score: "88%" },
                { id: 3, name: "Alan Wong", email: "alan@ops.io", status: "Away", toggle: true, processed: 30, score: "74%" },
                { id: 4, name: "Sara Johnson", email: "sara@ops.io", status: "Inactive", toggle: false, processed: 0, score: "N/A" },
                { id: 5, name: "David Lee", email: "d.lee@ops.io", status: "Offline", toggle: false, processed: 12, score: "90%" }
            ],
            credits: {
                total: 10000,
                used: 6430
            },
            currentTab: 'dashboard'
        };

        window.onload = () => {
            renderAdmins();
            renderPerformance();
            updateCreditUI();
            updateStats();
            console.log("Master Command Center V3.1 Live Initialized.");
        };

        function renderAdmins() {
            const area = document.getElementById('admin-render-area');
            area.innerHTML = AppState.admins.map(admin => `
                <div class="flex justify-between items-center p-4 border-b border-slate-50 hover:bg-slate-50/50 transition-all rounded-xl">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-black text-[10px] text-slate-400">
                            ${admin.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div>
                            <p class="text-sm font-bold text-slate-700">${admin.name}</p>
                            <p class="text-[10px] text-slate-400 font-medium">${admin.email}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-[9px] font-black uppercase ${admin.status === 'Active' ? 'text-emerald-500' : 'text-slate-300'}">${admin.status}</span>
                        <div class="custom-toggle ${admin.toggle ? 'active' : ''}" onclick="toggleAdminSeat(${admin.id})">
                            <div class="toggle-circle"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderPerformance() {
            const area = document.getElementById('performance-render-area');
            area.innerHTML = AppState.admins.slice(0, 4).map(admin => `
                <tr class="border-b border-slate-50 hover:bg-slate-50/30 transition">
                    <td class="py-4">
                        <p class="text-xs font-bold text-slate-700">${admin.name}</p>
                        <p class="text-[9px] text-slate-400 uppercase font-bold">Seat #${admin.id}</p>
                    </td>
                    <td class="py-4 text-center">
                        <span class="text-xs font-black text-slate-600">${admin.processed}</span>
                    </td>
                    <td class="py-4 text-right">
                        <span class="text-xs font-black ${parseInt(admin.score) > 85 ? 'text-emerald-500' : 'text-blue-500'}">${admin.score}</span>
                    </td>
                </tr>
            `).join('');
        }

        function updateCreditUI() {
            const pct = (AppState.credits.used / AppState.credits.total) * 100;
            document.getElementById('credit-bar').style.width = pct + '%';
            document.getElementById('credits-left-text').innerText = `${(AppState.credits.total - AppState.credits.used).toLocaleString()} Credits Remaining`;
            document.getElementById('credits-used-text').innerText = AppState.credits.used.toLocaleString();
        }

        function updateStats() {
            const active = AppState.admins.filter(a => a.toggle).length;
            document.getElementById('stat-active-admins').innerText = active.toString().padStart(2, '0');
        }

        window.toggleAdminSeat = (id) => {
            const admin = AppState.admins.find(a => a.id === id);
            if (admin) {
                admin.toggle = !admin.toggle;
                admin.status = admin.toggle ? "Active" : "Offline";
                renderAdmins();
                updateStats();
            }
        };

        window.provisionSeat = () => {
            const email = document.getElementById('newAdminEmail').value;
            if(!email) return alert("Enter admin email");
            
            // Simulation of boss action: Provisioning
            const newId = AppState.admins.length + 1;
            AppState.admins.push({
                id: newId,
                name: email.split('@')[0],
                email: email,
                status: "Active",
                toggle: true,
                processed: 0,
                score: "New"
            });
            renderAdmins();
            updateStats();
            closeModal('adminModal');
            alert(`Seat Provisioned for ${email}`);
        };

        window.switchTab = (tabId) => {
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active', 'text-white');
                link.classList.add('text-slate-500');
            });
            document.getElementById('nav-' + tabId).classList.add('active');
            document.getElementById('nav-' + tabId).classList.remove('text-slate-500');

            const titles = {
                dashboard: ["Executive Dashboard", "Real-time system integrity and performance metrics."],
                admins: ["Seat Provisioning", "Authorized access management for your operational team."],
                tank: ["Data Gatekeeper", "Control raw applicant flow before admin release."],
                credits: ["Financial Ledger", "Volume consumption and billing cycle oversight."]
            };

            document.getElementById('view-title').innerText = titles[tabId][0];
            document.getElementById('view-subtitle').innerText = titles[tabId][1];
            console.log(`Routing to: ${tabId}`);
        };

        window.openModal = (id) => document.getElementById(id).classList.remove('hidden');
        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');

        // Kill Switch: Integrated with Firebase Auth
        window.systemLogout = async () => {
            if(confirm("DANGER: Terminating the Master Admin session will stop live telemetry. Continue?")) {
                try {
                    if(window.auth) await window.auth.signOut();
                    window.location.reload();
                } catch (e) {
                    window.location.reload();
                }
            }
        };

        // Telemetry still functions as a fallback or for UI smoothness
        setInterval(() => {
            if(AppState.credits.used < AppState.credits.total) {
                AppState.credits.used += Math.floor(Math.random() * 2);
                updateCreditUI();
            }
        }, 8000);

    </script>
</body>
</html>

