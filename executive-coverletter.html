<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickCV Pro | Enterprise Cover Letter Engine</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,700&family=Inter:wght@400;500;600&display=swap');
        
        :root {
            --primary-dark: #070b14;
            --accent-blue: #2563eb;
            --accent-purple: #7c3aed;
            --glass-bg: rgba(15, 23, 42, 0.85);
            --executive-gold: #c5a059;
            --cv-header-blue: #0f172a;
        }

        /* MASTER THEME (IDENTICAL TO CV CODES) */
        body { 
            background-color: var(--primary-dark); 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            color: #f8fafc; 
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .glass-panel { 
            background: var(--glass-bg); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
        }

        .premium-gradient-btn { 
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .input-field {
            background: rgba(255,255,255,0.03) !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            color: white !important;
            outline: none;
        }

        .input-field:focus {
            border-color: var(--accent-blue) !important;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        /* EXECUTIVE PDF RENDERING ENGINE (A4 PRECISION) */
        #clRenderArea { 
            width: 210mm; 
            background: white; 
            color: #1a1a1a; 
            position: absolute; 
            left: -9999px; 
            padding-bottom: 30mm;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        .cl-header { 
            background: var(--cv-header-blue); 
            color: white; 
            padding: 45px 25mm; 
            text-align: center; 
        }

        .cl-name { 
            font-family: 'Playfair Display', serif; 
            font-size: 32pt; 
            letter-spacing: 4px; 
            text-transform: uppercase; 
            line-height: 1; 
            font-weight: 700;
        }

        .cl-title { 
            color: var(--executive-gold); 
            font-size: 13pt; 
            letter-spacing: 4px; 
            margin-top: 15px; 
            font-weight: 700; 
            text-transform: uppercase;
            border-top: 1px solid rgba(255,255,255,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.2);
            display: inline-block;
            padding: 8px 20px;
        }

        .cl-contact-bar { 
            background: #1e293b; 
            color: #cbd5e1; 
            padding: 12px; 
            font-size: 9pt; 
            display: flex; 
            justify-content: center; 
            gap: 25px; 
            font-weight: 500; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .cl-body-content { 
            padding: 40px 25mm; 
            font-family: 'Inter', sans-serif; 
            font-size: 11pt; 
            line-height: 1.8; 
            color: #2d3748; 
        }

        .cl-body-content p { margin-bottom: 1.5rem; text-align: justify; }

        /* MODAL OVERLAY (MATCHES CV PREVIEW) */
        #previewModal { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: rgba(2, 6, 23, 0.98); 
            z-index: 1000; 
            overflow-y: auto; 
            padding: 40px 20px; 
        }

        .edit-canvas {
            background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            outline: none;
        }

        /* ATS OVERRIDES */
        .ats-optimized .cl-header { background: white !important; color: black !important; border-bottom: 2px solid #000; padding: 20px 25mm !important; }
        .ats-optimized .cl-name { font-family: Arial, sans-serif !important; color: black !important; letter-spacing: 0; font-size: 24pt; }
        .ats-optimized .cl-title { color: #333 !important; border: none; padding: 0; margin-top: 5px; }
        .ats-optimized .cl-contact-bar { background: white !important; color: #333 !important; border-bottom: 1px solid #eee; }
        .ats-optimized .cl-body-content { font-family: "Times New Roman", serif !important; font-size: 12pt !important; }
    </style>
</head>
<body>

    <nav class="max-w-7xl mx-auto p-8 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-500/20">
                <i class="fas fa-file-invoice text-white text-xl"></i>
            </div>
            <div>
                <h1 class="text-2xl font-black tracking-tighter leading-none">QUICK<span class="text-blue-500">CV</span></h1>
                <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Executive Cover Letter Engine</span>
            </div>
        </div>
        
        <div class="flex items-center gap-6">
            <div id="syncStatus" class="text-[10px] font-black text-slate-400 px-6 py-3 rounded-full border border-white/10 glass-panel flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-orange-500 animate-pulse"></div>
                CONNECTING TO CV PROFILE...
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-6 pb-48">
        
        <div class="mb-16">
            <div class="flex items-center gap-4 mb-8">
                <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-bold text-xs">01</div>
                <h3 class="text-xs font-black uppercase tracking-[0.3em] text-slate-500">Letter Strategy</h3>
                <div class="h-px flex-1 bg-white/5"></div>
            </div>
            
            <div class="glass-panel p-10 rounded-[3rem] grid md:grid-cols-3 gap-8">
                <div class="space-y-3">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2">Tone & Persona</label>
                    <select id="letterTone" class="w-full p-5 rounded-2xl input-field text-sm font-bold">
                        <option value="executive" selected>Executive Leadership (Confident)</option>
                        <option value="creative">Creative / Visionary (Bold)</option>
                        <option value="standard">Corporate Standard (Balanced)</option>
                        <option value="entry">Modern Tech (Direct)</option>
                    </select>
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2">Focus Area</label>
                    <select id="focusArea" class="w-full p-5 rounded-2xl input-field text-sm font-bold">
                        <option value="roi">Revenue & ROI Impact</option>
                        <option value="leadership">Team & Culture Leadership</option>
                        <option value="tech">Technical Implementation</option>
                        <option value="efficiency">Operational Efficiency</option>
                    </select>
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2">Letter Density</label>
                    <select id="letterLength" class="w-full p-5 rounded-2xl input-field text-sm font-bold">
                        <option value="short">One-Page Concise</option>
                        <option value="standard" selected>Standard Professional</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="mb-16">
            <div class="flex items-center gap-4 mb-8">
                <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-bold text-xs">02</div>
                <h3 class="text-xs font-black uppercase tracking-[0.3em] text-slate-500">Target Recipient</h3>
                <div class="h-px flex-1 bg-white/5"></div>
            </div>
            
            <div class="glass-panel p-10 rounded-[3rem] grid md:grid-cols-2 gap-8">
                <div class="space-y-3">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2">Company Name</label>
                    <input type="text" id="targetCompany" placeholder="e.g. Tesla" class="w-full p-5 rounded-2xl input-field">
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2">Target Role</label>
                    <input type="text" id="targetRole" placeholder="e.g. Senior VP of Operations" class="w-full p-5 rounded-2xl input-field">
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2">Addressed To</label>
                    <input type="text" id="hrName" placeholder="e.g. Sarah Mitchell" class="w-full p-5 rounded-2xl input-field">
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2">The "Why" Hook</label>
                    <input type="text" id="motivation" placeholder="e.g. your expansion into renewable energy" class="w-full p-5 rounded-2xl input-field">
                </div>
            </div>
        </div>

        <div class="mb-16">
            <div class="flex items-center gap-4 mb-8">
                <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-bold text-xs">03</div>
                <h3 class="text-xs font-black uppercase tracking-[0.3em] text-slate-500">Executive Proof Points</h3>
                <div class="h-px flex-1 bg-white/5"></div>
            </div>
            
            <div class="glass-panel p-10 rounded-[3rem] space-y-6">
                <div id="metricsContainer" class="grid md:grid-cols-1 gap-4">
                    <div class="relative group">
                        <input type="text" class="impact-metric w-full p-5 rounded-2xl input-field text-sm" placeholder="Evidence 1: e.g. Increased net profit margin by 14% through process automation...">
                        <i class="fas fa-chart-line absolute right-6 top-5 text-slate-600 group-focus-within:text-blue-500 transition-colors"></i>
                    </div>
                </div>
                
                <div class="flex items-center justify-between pt-6 border-t border-white/5">
                    <button onclick="addMetricField()" class="text-xs font-black uppercase tracking-widest text-blue-400 hover:text-blue-300 flex items-center gap-2 transition-all">
                        <i class="fas fa-plus-circle"></i> Add Data Point
                    </button>
                    
                    <label class="flex items-center gap-4 cursor-pointer">
                        <span class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500">ATS Optimized Render</span>
                        <div class="relative">
                            <input type="checkbox" id="atsMode" class="sr-only">
                            <div class="w-12 h-6 bg-slate-800 rounded-full border border-white/10"></div>
                            <div class="dot absolute left-1 top-1 w-4 h-4 bg-white/20 rounded-full transition-all"></div>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <div class="fixed bottom-12 left-1/2 -translate-x-1/2 w-full max-w-lg px-6 z-[100]">
            <button onclick="preparePreview()" class="premium-gradient-btn w-full py-7 rounded-[2.5rem] font-black uppercase text-sm tracking-[4px] shadow-2xl flex items-center justify-center gap-4 group">
                <span class="group-hover:scale-110 transition-transform">
                    <i class="fas fa-wand-magic-sparkles"></i>
                </span>
                Generate & Polish Letter
            </button>
        </div>
    </main>

    <div id="previewModal">
        <div class="max-w-5xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center gap-8 mb-12 border-b border-white/10 pb-8">
                <div>
                    <h2 class="text-4xl font-black text-white italic tracking-tighter">PREVIEW <span class="text-blue-500">ENGINE.</span></h2>
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mt-2">Manual Editing Enabled â€” Just click on the text to refine.</p>
                </div>
                <div class="flex gap-4 w-full md:w-auto">
                    <button onclick="closePreview()" class="flex-1 md:flex-none px-8 py-5 rounded-2xl font-black text-xs tracking-widest text-slate-400 border border-white/10 hover:bg-white/5">DISCARD</button>
                    <button onclick="generatePDF()" id="downloadBtn" class="flex-1 md:flex-none bg-white text-black px-12 py-5 rounded-2xl font-black text-xs tracking-[2px] flex items-center justify-center gap-3 hover:bg-blue-500 hover:text-white transition-all">
                        <i class="fas fa-file-pdf"></i> EXPORT TO PDF
                    </button>
                </div>
            </div>
            
            <div id="previewContainer" class="flex justify-center overflow-x-auto rounded-xl"></div>
        </div>
    </div>

    <div id="clRenderArea">
        <div class="cl-header">
            <h1 id="pdf-name" class="cl-name"></h1>
            <div class="cl-title-wrap">
                <div id="pdf-title" class="cl-title"></div>
            </div>
        </div>
        <div id="pdf-contact" class="cl-contact-bar"></div>
        
        <div class="cl-body-content">
            <div id="pdf-date" style="margin-bottom: 25px; font-weight: 800; color: #1e293b; font-size: 10pt;"></div>
            
            <div style="margin-bottom: 35px; border-left: 3px solid #c5a059; padding-left: 15px;">
                <strong id="pdf-hr-name" style="font-size: 11pt; color: #0f172a;"></strong><br>
                <span id="pdf-comp-name" style="text-transform: uppercase; letter-spacing: 1.5px; color: #64748b; font-size: 9pt; font-weight: 700;"></span>
            </div>

            <div id="pdf-body">
                </div>

            <div style="margin-top: 50px;">
                <p style="margin-bottom: 5px;">Respectfully,</p>
                <div id="pdf-sig-name" style="font-family: 'Playfair Display', serif; font-size: 22pt; color: #0f172a; font-weight: 700;"></div>
                <div id="pdf-sig-title" style="font-size: 9pt; color: #c5a059; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG (Ensure this matches your CV Project)
        const firebaseConfig = { /* ... your config ... */ };
        
        let cvData = null;
        let auth, db;

        // --- AUTH & SYNC (MATCHES CV) ---
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            onAuthStateChanged(auth, async (user) => {
                const statusEl = document.getElementById('syncStatus');
                if (user) {
                    statusEl.innerHTML = '<i class="fas fa-sync fa-spin"></i> SYNCING CV PROFILE...';
                    const docSnap = await getDoc(doc(db, "drafts", user.uid));
                    if (docSnap.exists()) {
                        cvData = docSnap.data();
                        statusEl.innerHTML = '<i class="fas fa-check-circle text-green-500"></i> CV DATA LOADED';
                        statusEl.classList.add('border-green-500/30');
                        // Pre-fill signature
                        document.getElementById('pdf-sig-name').innerText = cvData.fullName || "EXECUTIVE APPLICANT";
                    }
                } else {
                    statusEl.innerHTML = '<i class="fas fa-user-slash text-slate-500"></i> GUEST MODE (NO SYNC)';
                }
            });
        } catch (e) {
            console.warn("Sync logic paused. Firebase missing.");
        }

        // --- GENERATION ENGINE ---
        window.preparePreview = () => {
            const company = document.getElementById('targetCompany').value || "[Target Organization]";
            const role = document.getElementById('targetRole').value || "[Target Role]";
            const hr = document.getElementById('hrName').value || "Hiring Manager";
            const why = document.getElementById('motivation').value || "your innovative market positioning";
            const metrics = Array.from(document.querySelectorAll('.impact-metric')).map(i => i.value).filter(v => v !== "");
            
            // Map Template Data
            document.getElementById('pdf-name').innerText = (cvData?.fullName || "EXECUTIVE APPLICANT").toUpperCase();
            document.getElementById('pdf-title').innerText = (cvData?.jobTitle || "PROFESSIONAL").toUpperCase();
            document.getElementById('pdf-contact').innerHTML = `
                <span>${cvData?.phone || '000-000-0000'}</span> | 
                <span>${cvData?.email || 'OFFICE@EXECUTIVE.COM'}</span> | 
                <span>${cvData?.location || 'GLOBAL'}</span>
            `;
            document.getElementById('pdf-date').innerText = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }).toUpperCase();
            document.getElementById('pdf-hr-name').innerText = `To the attention of ${hr},`;
            document.getElementById('pdf-comp-name').innerText = company;
            document.getElementById('pdf-sig-title').innerText = cvData?.jobTitle || "";

            // Dynamic Copywriter
            const intro = `<p>It is with substantial interest that I submit my credentials for the ${role} position at ${company}. Having followed your organization's recent milestones, specifically ${why}, I am eager to offer my leadership and strategic expertise to your executive team.</p>`;
            
            let proofHtml = "";
            if(metrics.length > 0) {
                proofHtml = `<p>My career has been defined by a relentless focus on high-impact results. Most notably, I have successfully ${metrics.join(' and ')}. These achievements demonstrate my ability to translate complex challenges into profitable growth and operational excellence.</p>`;
            } else {
                proofHtml = `<p>Throughout my tenure as a ${cvData?.jobTitle || 'professional'}, I have maintained a reputation for excellence in strategic execution. I am confident that my background in the industry aligns perfectly with the current trajectory of ${company}.</p>`;
            }

            const closing = `<p>I welcome the opportunity to discuss how my forward-thinking approach can support the long-term objectives of ${company}. Thank you for your time and professional consideration.</p>`;

            document.getElementById('pdf-body').innerHTML = intro + proofHtml + closing;

            // Handle ATS Toggle
            const master = document.getElementById('clRenderArea');
            if (document.getElementById('atsMode').checked) {
                master.classList.add('ats-optimized');
            } else {
                master.classList.remove('ats-optimized');
            }

            // Render Preview Canvas (Editable)
            const container = document.getElementById('previewContainer');
            container.innerHTML = '';
            const clone = master.cloneNode(true);
            clone.id = "editablePreview";
            clone.style.position = "relative";
            clone.style.left = "0";
            clone.classList.add('edit-canvas');
            clone.setAttribute("contenteditable", "true");
            container.appendChild(clone);

            document.getElementById('previewModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        };

        // --- EXPORT ENGINE (A4 PDF) ---
        window.generatePDF = async () => {
            const { jsPDF } = window.jspdf;
            const btn = document.getElementById('downloadBtn');
            const edited = document.getElementById('editablePreview');
            const master = document.getElementById('clRenderArea');

            // Sync Edits
            master.innerHTML = edited.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> GENERATING...';
            
            master.style.position = "static";
            master.style.left = "0";

            const doc = new jsPDF('p', 'mm', 'a4');

            try {
                await doc.html(master, {
                    callback: function(pdf) {
                        pdf.save(`CoverLetter_${document.getElementById('targetCompany').value || 'Executive'}.pdf`);
                        master.style.position = "absolute";
                        master.style.left = "-9999px";
                        btn.innerHTML = '<i class="fas fa-check"></i> SAVED';
                        setTimeout(() => window.closePreview(), 1500);
                    },
                    x: 0,
                    y: 0,
                    width: 210,
                    windowWidth: 793 // Precise A4 Pixel Mapping
                });
            } catch (err) {
                console.error("PDF Export Error:", err);
                btn.innerHTML = 'ERROR EXPORTING';
            }
        };

        // --- HELPERS ---
        window.closePreview = () => {
            document.getElementById('previewModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('downloadBtn').innerHTML = '<i class="fas fa-file-pdf"></i> EXPORT TO PDF';
        };

        window.addMetricField = () => {
            const container = document.getElementById('metricsContainer');
            const div = document.createElement('div');
            div.className = "relative group animate-fadeIn";
            div.innerHTML = `
                <input type="text" class="impact-metric w-full p-5 rounded-2xl input-field text-sm" placeholder="Additional Proof Point...">
                <i class="fas fa-bolt absolute right-6 top-5 text-blue-500"></i>
            `;
            container.appendChild(div);
        };
    </script>
</body>
</html>




