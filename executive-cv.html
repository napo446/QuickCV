<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickCV | The Executive Workspace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Playfair+Display:wght@700&display=swap');
        
        body { background-color: #070b14; font-family: 'Plus Jakarta Sans', sans-serif; color: #f8fafc; overflow-x: hidden; }
        .glass-panel { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .executive-blue { background-color: #2c4a70; }
        .gold-accent { color: #c5a059; }
        .premium-gradient { background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%); }
        

        /* CV Preview Rendering Container (Hidden from view) */
        #cvRenderArea { width: 210mm; background: white; color: #333; position: absolute; left: -9999px; padding-bottom: 20mm;}
.cv-header { 
    background: white; 
    color: #2c4a70; 
    padding: 20px 40px 10px 40px; 
    text-align: center; 
}
.cv-name { 
    font-family: 'Plus Jakarta Sans', sans-serif; 
    font-size: 28pt; 
    font-weight: 500; 
    letter-spacing: 2px; 
    text-transform: uppercase; 
}
.cv-title { 
    color: #2c4a70; 
    font-size: 14pt; 
    font-weight: 600; 
    margin-top: 5px;
    border-top: 1.5px solid #2c4a70;
    border-bottom: 1.5px solid #2c4a70;
    padding-bottom: 10px;
}
.cv-contact-bar { 
    background: transparent; 
    color: #333; 
    padding: 10px; 
    font-size: 9pt; 
    display: flex; 
    justify-content: center; 
    gap: 15px; 
    border-bottom: 1px solid #ccc;
    margin: 0 40px;
}

/* CRITICAL: Prevents text from being sliced in half horizontally */
#pdf-experience > div, 
#pdf-education > div, 
#pdf-certs > div,
.pdf-achievement-row {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    display: block;
    position: relative; /* Helps html2canvas calculate bounds */
    margin-bottom: 10px;
}



  /* Perfect alignment for professional bullets */
.pdf-achievement-row {
    display: flex;
    margin-bottom: 5px;
    align-items: flex-start;
}
.pdf-bullet {
    color: #c5a059; /* Gold color */
    margin-right: 10px;
    font-weight: bold;
}

  /* Styling for the section headers like the image */
.pdf-section-header {
    text-align: center;
    font-size: 11pt;
    font-weight: 800;
    color: #2c4a70;
    text-transform: uppercase;
    margin-top: 25px;
    margin-bottom: 15px;
    border-top: 1px solid #aebacb;
    border-bottom: 1px solid #aebacb;
    padding: 5px 0;
    display: block;
    letter-spacing: 1px;
}




/* Add this inside your <style> tags */
[contenteditable="true"]:focus {
    outline: none;
    background: rgba(37, 99, 235, 0.03); /* Very subtle blue hint that you are editing */
    transition: background 0.3s ease;
}

#livePreviewCV {
    cursor: text;
}

     /* Forces the browser to render text with high precision in the preview */
#cvRenderArea, #livePreviewCV {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    filter: none !important; /* Disables any accidental blur inheritance */
    backdrop-filter: none !important; /* Ensures background effects don't bleed into the text */
}

/* Ensures the preview modal doesn't use the expensive blur effect on top of the CV */
#previewModal {
    backdrop-filter: none !important;
    background: rgba(0, 0, 0, 0.98); /* Use a solid dark color instead of a blur */
}

   #livePreviewCV:focus {
    outline: 2px solid #2563eb;
    border-radius: 4px;
}

        
    </style>
</head>
<body>

<div id="saveStatus" class="fixed bottom-32 right-10 opacity-0 transition-opacity duration-500 bg-emerald-500 text-white text-[10px] font-bold px-4 py-2 rounded-full shadow-lg z-[100]">
    <i class="fas fa-cloud-upload-alt mr-2"></i> SYNCED TO CLOUD
</div>


    <nav class="max-w-7xl mx-auto p-6 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <a href="template.html" class="w-10 h-10 rounded-full glass-panel flex items-center justify-center hover:bg-white/10 transition">
                <i class="fas fa-arrow-left text-xs text-slate-400"></i>
            </a>
            <h1 class="text-xl font-black tracking-tighter">QuickCV <span class="text-blue-500">EXECUTIVE</span></h1>
       <div id="accessStatus" class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">
       </div>
        
        </div>
    </nav>

    <main class="max-w-5xl mx-auto p-6 pb-32">
        
        <section id="step-1" class="mb-12">
            <div class="glass-panel p-8 rounded-[2.5rem] border-blue-500/30">
                <div class="flex flex-col md:flex-row gap-8 items-center">
                    <img src="assets/executive.png" class="w-48 rounded-lg shadow-2xl border border-white/10" alt="Executive Preview">
                    <div>
                        <h2 class="text-3xl font-black mb-2">The Executive</h2>
                        <div class="flex gap-2 mb-4">
                            <span class="bg-blue-500/20 text-blue-400 text-[10px] px-3 py-1 rounded-full font-bold uppercase">Global Corporate Standard</span>
                            <span class="bg-emerald-500/20 text-emerald-400 text-[10px] px-3 py-1 rounded-full font-bold uppercase">ATS Score: 98%</span>
                        </div>
                        <ul class="text-slate-400 text-sm space-y-2 mb-6">
                            <li><i class="fas fa-check-circle text-blue-500 mr-2"></i> Optimized for CEO & C-Suite leadership metrics</li>
                            <li><i class="fas fa-check-circle text-blue-500 mr-2"></i> High-authority typography & layout</li>
                        </ul>
                        <button onclick="document.getElementById('step-2').scrollIntoView({behavior:'smooth'})" class="premium-gradient px-8 py-4 rounded-2xl font-black uppercase text-sm tracking-widest hover:scale-105 transition">
                            Build My Executive CV
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="step-2" class="space-y-6 mb-12">
            <h3 class="text-lg font-black uppercase tracking-widest text-slate-500">The Executive Seal</h3>
            <div class="glass-panel p-8 rounded-[2.5rem] grid md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Full Name</label>
                    <input type="text" id="fullName" placeholder="MICHAEL ANDERSON" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-blue-500 text-white font-bold uppercase">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Professional Title</label>
                    <input type="text" id="jobTitle" placeholder="CHIEF OPERATIONS OFFICER" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-blue-500 text-white font-bold uppercase">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Phone Number</label>
                    <input type="text" id="phone" placeholder="+27 82 123 4567" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-blue-500">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">Email Address</label>
                    <input type="email" id="email" placeholder="michael.anderson@email.com" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-blue-500">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">LinkedIn URL</label>
                    <input type="text" id="linkedin" placeholder="linkedin.com/in/michael" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-blue-500">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">City & Country</label>
                    <input type="text" id="location" placeholder="Johannesburg, South Africa" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-blue-500">
                </div>
            </div>
        </section>

        <section class="space-y-6 mb-12">
            <h3 class="text-lg font-black uppercase tracking-widest text-slate-500">Executive Profile</h3>
            <div class="glass-panel p-8 rounded-[2.5rem]">
                <textarea id="summary" rows="5" placeholder="Accomplished leader with 18+ years of experience driving operational excellence..." class="w-full bg-white/5 border border-white/10 p-6 rounded-2xl outline-none focus:border-blue-500 text-slate-300 leading-relaxed"></textarea>
                <div class="mt-4 flex gap-2">
<button onclick="window.usePowerVerbs()" class="text-[10px] bg-slate-500/10 text-slate-400 px-4 py-2 rounded-full font-bold hover:bg-slate-500/30 transition">USE POWER VERBS</button>

                </div>
            </div>
        </section>

        <section class="space-y-6 mb-12">
            <h3 class="text-lg font-black uppercase tracking-widest text-slate-500">Core Expertise Grid</h3>
            <div class="glass-panel p-8 rounded-[2.5rem]">
                <div id="skillsContainer" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    </div>
                <div class="mt-6 flex gap-2">
                    <input type="text" id="skillInput" placeholder="Add Skill (e.g., P&L Management)" class="flex-1 bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-blue-500">
                    <button onclick="addSkill()" class="bg-blue-600 text-white px-8 rounded-2xl font-bold">ADD</button>
                </div>
            </div>
        </section>

        <section class="space-y-6 mb-12">
            <div class="flex justify-between items-center">
                <h3 class="text-lg font-black uppercase tracking-widest text-slate-500">Result-Driven Experience</h3>
                <button onclick="addExperience()" class="bg-blue-600/10 text-blue-400 text-xs font-black px-4 py-2 rounded-xl border border-blue-600/20">+ ADD ROLE</button>
            </div>
            <div id="experienceList" class="space-y-6">
                </div>
        </section>

        <section class="space-y-6 mb-12">
    <div class="flex justify-between items-center">
        <h3 class="text-lg font-black uppercase tracking-widest text-slate-500">Education & Trust Signals</h3>
        <button onclick="addEducation()" class="bg-blue-600/10 text-blue-400 text-xs font-black px-4 py-2 rounded-xl border border-blue-600/20">+ ADD EDUCATION</button>
    </div>
    <div id="educationList" class="space-y-6">
        </div>

<section class="space-y-6 mb-12">
    <h3 class="text-lg font-black uppercase tracking-widest text-slate-500">Executive Credentials</h3>
    <div class="glass-panel p-8 rounded-[2.5rem]">
        <label class="text-[10px] font-bold text-slate-400 uppercase mb-4 block">Certifications & Board Memberships</label>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <input type="text" id="certName" placeholder="Certificate (e.g. MBA)" 
                   class="bg-white/5 border border-white/10 p-4 rounded-xl text-xs outline-none focus:border-blue-500 text-white">
            <input type="text" id="certOrg" placeholder="Institution (e.g. INSEAD)" 
                   class="bg-white/5 border border-white/10 p-4 rounded-xl text-xs outline-none focus:border-blue-500 text-white">
            <input type="text" id="certYear" placeholder="Year" 
                   class="bg-white/5 border border-white/10 p-4 rounded-xl text-xs outline-none focus:border-blue-500 text-white">
        </div>
        
        <button onclick="window.addCustomCert()" class="mt-3 w-full bg-blue-600/10 hover:bg-blue-600/20 text-blue-400 py-4 rounded-xl text-[10px] font-black uppercase tracking-widest border border-blue-600/20 transition">
            + ADD TO EXECUTIVE RECORD
        </button>

        <div id="customCertList" class="flex flex-wrap gap-2 mt-4"></div>
    </div>
</section>

<section class="space-y-6 mb-12">
    <div class="flex justify-between items-center">
        <h3 class="text-lg font-black uppercase tracking-widest text-slate-500">Linguistic Proficiency</h3>
        <button onclick="addLanguage()" class="bg-blue-600/10 text-blue-400 text-xs font-black px-4 py-2 rounded-xl border border-blue-600/20">+ ADD LANGUAGE</button>
    </div>
    <div id="languageList" class="grid md:grid-cols-2 gap-4">
        </div>
</section>

        <section class="space-y-6 mb-12">
    <div class="flex justify-between items-center">
        <h3 class="text-lg font-black uppercase tracking-widest text-slate-500">Executive References</h3>
        <button onclick="addReference()" class="bg-blue-600/10 text-blue-400 text-xs font-black px-4 py-2 rounded-xl border border-blue-600/20">+ ADD REFERENCE</button>
    </div>
    <div id="referenceList" class="space-y-4">
        </div>
</section>

        
        <div class="fixed bottom-0 left-0 w-full glass-panel p-6 z-[50] flex gap-4 justify-center">
 <button onclick="window.showExecutivePreview()" class="premium-gradient px-12 py-5 rounded-2xl font-black uppercase text-sm tracking-[2px] shadow-2xl hover:scale-105 active:scale-95 transition-all">
    <i class="fas fa-eye mr-2"></i> Review & Generate
</button>

        </div>

    </main>

    <div id="cvRenderArea" style="font-family: 'Plus Jakarta Sans', sans-serif; width: 210mm; background: white; color: #333; position: absolute; left: -9999px;">
        <div class="cv-header">
            <div id="pdf-name" class="cv-name">MICHAEL ANDERSON</div>
            <div id="pdf-title" class="cv-title">CHIEF OPERATIONS OFFICER</div>
        </div>
        <div id="pdf-contact" class="cv-contact-bar">
            <span>+27 82 123 4567</span> | <span>michael@email.com</span> | <span>linkedin/michael</span>
        </div>
        <div style="padding: 40px; font-size: 10pt; line-height: 1.6;">
â€‹<div class="pdf-section-header">EXECUTIVE PROFILE</div>
            <p id="pdf-summary" style="margin-bottom: 25px;"></p>

<div class="pdf-section-header">CORE COMPETENCIES</div>
<div id="pdf-skills" style="margin-bottom: 25px; font-size: 10pt; font-weight: 600; text-align: center;"></div>

â€‹<div class="pdf-section-header">PROFESSIONAL EXPERIENCE</div>
            <div id="pdf-experience"></div> </div>
        
<div style="padding: 0 40px 40px 40px;">
    <div class="pdf-section-header">Education</div>
    <div id="pdf-education" style="color: #333; margin-bottom: 20px;"></div>

    <div class="pdf-section-header">Professional References</div>
    <div id="pdf-references" style="color: #333; font-size: 9.5pt; line-height: 1.6; margin-bottom: 20px;">
        </div>

    <div class="pdf-section-header">Languages</div>
    <div id="pdf-languages" style="display: flex; flex-wrap: wrap; gap: 20px; color: #333; font-size: 10pt; justify-content: center; margin-bottom: 20px;">
        </div>

    <div class="pdf-section-header">Certifications</div>
    <div id="pdf-certs" style="display: flex; flex-direction: column; gap: 8px; color: #333; font-size: 9.5pt;">
        </div>
</div>


    </div>
</div>

        
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG (Replace with yours)
        const firebaseConfig = {
            apiKey: "AIzaSyBcp0fkuwhOOyO7fgAlbCoftWwkuog-vwQ",
            authDomain: "quickcv-47c99.firebaseapp.com",
            projectId: "quickcv-47c99",
            storageBucket: "quickcv-47c99.firebasestorage.app",
            messagingSenderId: "541347686112",
            appId: "1:541347686112:web:b821dd7213ab8674959285"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userHasAccess = false;

        onAuthStateChanged(auth, async (user) => {
            
            if (!user) {
                window.location.href = 'user.html';
                return;
            }
            await checkAccess(user);
            await loadFromFirebase(user); // <--- PASTE THIS HERE
        });


async function checkAccess(user) {
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);

    if (userSnap.exists()) {
        const credits = userSnap.data().credits || 0;
        const badge = document.getElementById('accessStatus'); // Find the HTML element
        
        if (credits > 0) {
            userHasAccess = true;
            // UPDATE THE BADGE HERE
            if(badge) {
                badge.innerHTML = `<i class="fas fa-coins text-amber-500 mr-1"></i> ${credits} Credits Remaining`;
                badge.className = "text-[10px] font-bold text-blue-400 uppercase tracking-widest";
            }
        } else {
            denyAccess();
        }
    } else {
        denyAccess();
    }
}



           // --- FIREBASE PERSISTENCE ENGINE ---
        window.saveToFirebase = async function() {
            const user = auth.currentUser;
            if (!user) return;

            const draftData = {
                fullName: document.getElementById('fullName').value,
                jobTitle: document.getElementById('jobTitle').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                linkedin: document.getElementById('linkedin').value,
                location: document.getElementById('location').value,
                summary: document.getElementById('summary').value,
                skills: window.skills,
                customCerts: window.customCerts,
                experience: Array.from(document.querySelectorAll('#experienceList > div')).map(card => ({
                    company: card.querySelector('.exp-company').value,
                    role: card.querySelector('.exp-role').value,
                    date: card.querySelector('.exp-date').value,
                    context: card.querySelector('.exp-context').value,
                    bullets: card.querySelector('.exp-bullets').value
                })),
                references: Array.from(document.querySelectorAll('#referenceList > div')).map(card => ({
                name: card.querySelector('.ref-name').value,
                title: card.querySelector('.ref-title').value,
                relation: card.querySelector('.ref-relation').value,
                contact: card.querySelector('.ref-contact').value
                })),
                languages: Array.from(document.querySelectorAll('#languageList > div')).map(card => ({
                name: card.querySelector('.lang-name').value,
                level: card.querySelector('.lang-level').value
                })),
                education: Array.from(document.querySelectorAll('#educationList > div')).map(card => ({
                    degree: card.querySelector('.edu-degree').value,
                    school: card.querySelector('.edu-school').value,
                    year: card.querySelector('.edu-year').value
                })),
                lastSaved: new Date()
            };

        try {
    const { setDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
    await setDoc(doc(db, "drafts", user.uid), draftData, { merge: true });
    
    // Show the badge
    const badge = document.getElementById('saveStatus');
    badge.classList.replace('opacity-0', 'opacity-100');
    setTimeout(() => badge.classList.replace('opacity-100', 'opacity-0'), 2000);
    
    console.log("Cloud Save Successful");
} catch (e) { 
     console.error("Error saving draft: ", e);
        }
      }      

        async function loadFromFirebase(user) {
            const docSnap = await getDoc(doc(db, "drafts", user.uid));
            if (docSnap.exists()) {
                const data = docSnap.data();
                
                document.getElementById('fullName').value = data.fullName || '';
                document.getElementById('jobTitle').value = data.jobTitle || '';
                document.getElementById('phone').value = data.phone || '';
                document.getElementById('email').value = data.email || '';
                document.getElementById('linkedin').value = data.linkedin || '';
                document.getElementById('location').value = data.location || '';
                document.getElementById('summary').value = data.summary || '';
                document.getElementById('referenceList').innerHTML = '';
if(data.references) data.references.forEach(ref => window.addReference(ref));
                
  document.getElementById('languageList').innerHTML = '';
if(data.languages) data.languages.forEach(lang => window.addLanguage(lang));
              
                window.skills = data.skills || [];
                window.customCerts = data.customCerts || [];
                
                document.getElementById('experienceList').innerHTML = '';
                if(data.experience) data.experience.forEach(exp => window.addExperience(exp));
                
                document.getElementById('educationList').innerHTML = '';
                if(data.education) data.education.forEach(edu => window.addEducation(edu));

                renderSkills();
                renderCustomCerts();
            } else {
                // No draft found, show defaults
                addExperience();
                addEducation();
                addReference();
                addLanguage();            }
        }
        
        let saveTimeout;
        document.addEventListener('input', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                clearTimeout(saveTimeout);
                // Waits 2 seconds after user stops typing to send to Firebase
                saveTimeout = setTimeout(() => {
                    saveToFirebase();
                }, 2000);
            }
        });

function denyAccess() {
    userHasAccess = false;
    const badge = document.getElementById('accessStatus');
    if(badge) {
        badge.innerHTML = `
            <div class="flex items-center gap-3">
                <span class="text-red-400"><i class="fas fa-lock mr-1"></i> 0 CREDITS</span>
                <a href="user.html" class="bg-blue-600 text-white px-3 py-1 rounded-md text-[9px] hover:bg-blue-500 transition shadow-lg">TOP UP</a>
            </div>
        `;
    }
    
    // ADD THIS LINE: This finds the Download button in your modal and greys it out
    const downloadBtn = document.querySelector('button[onclick="window.executeFinalDownload()"]');
    if(downloadBtn) {
        downloadBtn.disabled = true;
        downloadBtn.classList.replace('premium-gradient', 'bg-slate-800');
        downloadBtn.classList.add('cursor-not-allowed', 'opacity-50');
        downloadBtn.innerText = "LOCKED (0 CREDITS)";
    }
}



        // --- DYNAMIC FORM HANDLERS ---
        window.skills = ["P&L Management", "Strategic Planning", "Change Management", "Risk Governance", "Mergers & Acquisitions", "Operational Excellence"];
        
        window.renderSkills = () => {
            const container = document.getElementById('skillsContainer');
            container.innerHTML = window.skills.map((s, i) => `
                <div class="bg-white/5 border border-white/10 p-4 rounded-xl flex justify-between items-center group">
                    <span class="text-xs font-bold text-slate-300">â€¢ ${s}</span>
                    <i class="fas fa-times text-red-500 cursor-pointer opacity-0 group-hover:opacity-100 transition" onclick="removeSkill(${i})"></i>
                </div>
            `).join('');
        };

window.addSkill = () => {
    const val = document.getElementById('skillInput').value;
    if(val) { 
        window.skills.push(val); 
        document.getElementById('skillInput').value = ""; 
        renderSkills(); 
        saveToFirebase(); // Trigger cloud sync
    }
};

window.removeSkill = (i) => { 
    window.skills.splice(i, 1); 
    renderSkills(); 
    saveToFirebase(); // Trigger cloud sync
};


window.addExperience = (data = {}) => {
    // Unique ID prevents deletion bugs
    const id = Date.now() + Math.random().toString(36).substr(2, 5); 
    const html = `
        <div id="exp-${id}" class="glass-panel p-8 rounded-[2.5rem] relative">
            <button onclick="this.parentElement.remove(); saveToFirebase();" class="absolute top-6 right-6 text-red-500 hover:scale-110"><i class="fas fa-trash"></i></button>
            <div class="grid md:grid-cols-2 gap-4 mb-4">
                <input type="text" value="${data.company || ''}" placeholder="Company Name" class="exp-company bg-white/5 border border-white/10 p-4 rounded-xl text-sm font-bold">
                <input type="text" value="${data.role || ''}" placeholder="Job Title" class="exp-role bg-white/5 border border-white/10 p-4 rounded-xl text-sm font-bold">
                <input type="text" value="${data.date || ''}" placeholder="Duration" class="exp-date bg-white/5 border border-white/10 p-4 rounded-xl text-xs">
                <input type="text" value="${data.context || ''}" placeholder="Context" class="exp-context bg-white/5 border border-white/10 p-4 rounded-xl text-xs">
            </div>
            <textarea placeholder="Achievements..." class="exp-bullets w-full bg-white/5 border border-white/10 p-4 rounded-xl text-xs h-32">${data.bullets || ''}</textarea>
        </div>
    `;
    document.getElementById('experienceList').insertAdjacentHTML('beforeend', html);
    saveToFirebase(); // Force save when new role added
};

window.addEducation = (data = {}) => {
    const id = Date.now() + Math.random().toString(36).substr(2, 5);
    const html = `
        <div id="edu-${id}" class="glass-panel p-8 rounded-[2.5rem] relative">
            <button onclick="this.parentElement.remove(); saveToFirebase();" class="absolute top-6 right-6 text-red-500 hover:scale-110"><i class="fas fa-trash"></i></button>
            <div class="grid md:grid-cols-2 gap-4">
                <input type="text" value="${data.degree || ''}" placeholder="Degree" class="edu-degree bg-white/5 border border-white/10 p-4 rounded-xl text-sm font-bold">
                <input type="text" value="${data.school || ''}" placeholder="Institution" class="edu-school bg-white/5 border border-white/10 p-4 rounded-xl text-sm font-bold">
                <input type="text" value="${data.year || ''}" placeholder="Year" class="edu-year bg-white/5 border border-white/10 p-4 rounded-xl text-xs">
            </div>
        </div>
    `;
    document.getElementById('educationList').insertAdjacentHTML('beforeend', html);
    saveToFirebase(); // Force save when new education added
};

window.addReference = (data = {}) => {
    const id = Date.now() + Math.random().toString(36).substr(2, 5);
    const html = `
        <div id="ref-${id}" class="glass-panel p-6 rounded-[2rem] relative">
            <button onclick="this.parentElement.remove(); saveToFirebase();" class="absolute top-4 right-6 text-red-500 hover:scale-110"><i class="fas fa-trash text-xs"></i></button>
            <div class="grid md:grid-cols-2 gap-4">
                <input type="text" value="${data.name || ''}" placeholder="Full Name" class="ref-name bg-white/5 border border-white/10 p-3 rounded-xl text-xs font-bold text-white">
                <input type="text" value="${data.title || ''}" placeholder="Title & Company" class="ref-title bg-white/5 border border-white/10 p-3 rounded-xl text-xs text-white">
                <input type="text" value="${data.relation || ''}" placeholder="Relationship" class="ref-relation bg-white/5 border border-white/10 p-3 rounded-xl text-xs text-white">
                <input type="text" value="${data.contact || ''}" placeholder="Contact (Email/Phone)" class="ref-contact bg-white/5 border border-white/10 p-3 rounded-xl text-xs text-white">
            </div>
        </div>
    `;
    document.getElementById('referenceList').insertAdjacentHTML('beforeend', html);
    saveToFirebase(); 
};

window.addLanguage = (data = {}) => {
    const id = Date.now() + Math.random().toString(36).substr(2, 5);
    const html = `
        <div id="lang-${id}" class="glass-panel p-4 rounded-2xl relative flex gap-4 items-center border border-white/5">
            <button onclick="this.parentElement.remove(); window.saveToFirebase();" class="absolute -top-2 -right-2 bg-red-500 text-white w-6 h-6 rounded-full text-[10px] hover:scale-110 transition shadow-lg flex items-center justify-center">
                <i class="fas fa-times"></i>
            </button>
            <input type="text" value="${data.name || ''}" placeholder="e.g. English" class="lang-name bg-white/5 border border-white/10 p-3 rounded-xl text-xs font-bold text-white flex-1 outline-none focus:border-blue-500">
            
            <select onchange="window.saveToFirebase()" class="lang-level bg-slate-900 border border-white/10 p-3 rounded-xl text-[10px] text-blue-400 font-bold outline-none cursor-pointer">
                <option value="NATIVE" ${data.level === 'NATIVE' ? 'selected' : ''}>NATIVE</option>
                <option value="FULL PROFESSIONAL" ${data.level === 'FULL PROFESSIONAL' ? 'selected' : ''}>FULL PROFESSIONAL</option>
                <option value="PROFESSIONAL" ${data.level === 'PROFESSIONAL' ? 'selected' : ''}>PROFESSIONAL</option>
                <option value="LIMITED WORKING" ${data.level === 'LIMITED WORKING' ? 'selected' : ''}>LIMITED WORKING</option>
            </select>
        </div>
    `;
    document.getElementById('languageList').insertAdjacentHTML('beforeend', html);
    window.saveToFirebase();
};




window.customCerts = [];

window.addCustomCert = () => {
    const name = document.getElementById('certName').value;
    const org = document.getElementById('certOrg').value;
    const year = document.getElementById('certYear').value;

    if (name) {
        window.customCerts.push({ name, org, year });
        
        // Clear inputs
        document.getElementById('certName').value = "";
        document.getElementById('certOrg').value = "";
        document.getElementById('certYear').value = "";
        
        window.renderCustomCerts();
        window.saveToFirebase(); // Ensures cloud sync
    }
};

window.renderCustomCerts = () => {
    const container = document.getElementById('customCertList');
    if (!container) return; // Safety check

    container.innerHTML = window.customCerts.map((c, i) => {
        // Create safe strings so .toUpperCase() never hits 'undefined'
        const safeName = (c.name || "CERTIFICATE").toUpperCase();
        const safeOrg = (c.org || "INSTITUTION").toUpperCase();
        const safeYear = c.year || "";

        return `
            <span class="bg-blue-500/10 text-blue-400 border border-blue-500/20 px-3 py-2 rounded-lg text-[10px] font-bold flex items-center gap-2">
                ${safeName} | ${safeOrg} | ${safeYear}
                <i class="fas fa-times cursor-pointer hover:text-red-500 ml-2" onclick="window.customCerts.splice(${i},1); renderCustomCerts(); saveToFirebase()"></i>
            </span>
        `;
    }).join('');
};




        // --- GENERATION ENGINE ---
        window.validateAndGenerate = async () => {
            

            // Map UI to PDF Preview
            document.getElementById('pdf-name').innerText = document.getElementById('fullName').value || "MICHAEL ANDERSON";
            document.getElementById('pdf-title').innerText = document.getElementById('jobTitle').value || "CHIEF OPERATIONS OFFICER";
            document.getElementById('pdf-contact').innerHTML = `
                <span>${document.getElementById('phone').value}</span> | 
                <span>${document.getElementById('email').value}</span> | 
                <span>${document.getElementById('linkedin').value}</span> | 
                <span>${document.getElementById('location').value}</span>
            `;
            document.getElementById('pdf-summary').innerText = document.getElementById('summary').value;
            
 // Map Skills (Horizontal Executive Style)
const pdfSkills = document.getElementById('pdf-skills');
pdfSkills.style.textAlign = "center";
pdfSkills.style.fontSize = "9.5pt"; // Reduced size
pdfSkills.style.fontWeight = "400"; 
pdfSkills.style.lineHeight = "1.6";
pdfSkills.innerHTML = window.skills.join(' | '); 


// NEW FINAL DOWNLOAD MAPPING (SAFE VERSION)
let expHtml = "";
document.querySelectorAll('#experienceList > div').forEach(card => {
    // These 5 lines are now "Null-Safe"
    const company = (card.querySelector('.exp-company')?.value || "").toUpperCase();
    const role = (card.querySelector('.exp-role')?.value || "").toUpperCase();
    const date = card.querySelector('.exp-date')?.value || "";
    const context = card.querySelector('.exp-context')?.value || "";
    const bullets = (card.querySelector('.exp-bullets')?.value || "").split('\n').filter(line => line.trim() !== "");

    expHtml += `
        <div style="margin-bottom: 20px;">
            <div style="font-size: 10.5pt; color: #2c4a70; font-weight: 800; margin-bottom: 2px;">
                ${role} | ${company} | ${date}
            </div>
            
            ${context ? `<div style="font-size: 9pt; font-style: italic; color: #555; margin-bottom: 6px;">Scope: ${context}</div>` : ''}
            
            <div style="padding-left: 2px;">
                ${bullets.map(b => `
                    <div class="pdf-achievement-row" style="display:flex; font-size: 9.5pt; margin-bottom: 4px;">
                        <span style="color: #333; margin-right: 10px;">â€¢</span>
                        <span>${b.trim()}</span>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
});
document.getElementById('pdf-experience').innerHTML = expHtml;




// NEW FINAL DOWNLOAD MAPPING (SINGLE LINE EXECUTIVE STYLE)
let eduHtml = "";
document.querySelectorAll('#educationList > div').forEach(card => {
    // Optional chaining added here ?.
    const degree = (card.querySelector('.edu-degree')?.value || "").toUpperCase();
    const school = (card.querySelector('.edu-school')?.value || "").toUpperCase();
    const year = card.querySelector('.edu-year')?.value || "";
    
    if(degree || school) {
        eduHtml += `
            <div style="margin-bottom: 8px; line-height: 1.4; font-size: 10pt; color: #333;">
                <span style="font-weight: 800; color: #2c4a70;">${degree}</span> 
                <span> | ${school} | ${year}</span>
            </div>
        `;
    }
});
document.getElementById('pdf-education').innerHTML = eduHtml;






// --- FIXED SAFE VERSION ---
let certsHtml = "";
window.customCerts.forEach(c => {
    const safeName = (c.name || "CERTIFICATE").toUpperCase();
    const safeOrg = (c.org || "INSTITUTION").toUpperCase();
    const safeYear = c.year || "";

    certsHtml += `
        <div style="margin-bottom: 8px; line-height: 1.4; font-size: 10pt; color: #333;">
            <span style="font-weight: 800; color: #2c4a70;">${safeName}</span>
            <span style="color: #444;"> | ${safeOrg} | ${safeYear}</span>
        </div>`;
});

document.getElementById('pdf-certs').innerHTML = certsHtml;


let refHtml = "";
document.querySelectorAll('#referenceList > div').forEach(card => {
    // Optional chaining added here ?.
    const name = (card.querySelector('.ref-name')?.value || "").toUpperCase();
    const title = card.querySelector('.ref-title')?.value || "";
    const relation = card.querySelector('.ref-relation')?.value || "";
    const contact = card.querySelector('.ref-contact')?.value || "";

    if(name) {
        refHtml += `
            <div style="margin-bottom: 8px; line-height: 1.4; font-size: 10pt;">
                <span style="font-weight: 800; color: #2c4a70;">${name}</span> 
                <span style="color: #444;"> | ${title} | ${relation} | ${contact}</span>
            </div>
        `;
    }
});
document.getElementById('pdf-references').innerHTML = refHtml || "Available upon request";


let langHtml = "";
document.querySelectorAll('#languageList > div').forEach(card => {
    // Optional chaining added here ?.
    const name = (card.querySelector('.lang-name')?.value || "").toUpperCase();
    const level = card.querySelector('.lang-level')?.value || "";

    if(name) {
        langHtml += `
            <div style="margin-right: 15px; margin-bottom: 5px;">
                <span style="font-weight: 800; color: #2c4a70;">${name}</span> 
                <span style="color: #666; font-size: 8.5pt;"> | ${level}</span>
            </div>
        `;
    }
});
document.getElementById('pdf-languages').innerHTML = langHtml;



// Render PDF with Page Padding
const { jsPDF } = window.jspdf;
const doc = new jsPDF('p', 'mm', 'a4');
const element = document.getElementById('cvRenderArea');

const canvas = await html2canvas(element, { scale: 3, useCORS: true });
const imgData = canvas.toDataURL('image/png');

const pdfWidth = doc.internal.pageSize.getWidth();
const pageHeight = 297; 
const topMargin = 50.8; 

const imgProps = doc.getImageProperties(imgData);
const pdfImgHeight = (imgProps.height * pdfWidth) / imgProps.width;

// PASTE THIS NEW LOGIC:
const firstPageHeight = 297; // A4 height in mm
const subsequentPageMargin = 30; // Your requested 30mm gap
const effectivePageHeight = firstPageHeight - subsequentPageMargin;

let heightLeft = pdfImgHeight;
let position = 0; // The vertical "camera" position on your long CV image

// --- RENDER PAGE 1 ---
// On page 1, we start at the very top (0)
doc.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfImgHeight);
heightLeft -= firstPageHeight;
position -= firstPageHeight;

// --- RENDER SUBSEQUENT PAGES (2, 3, etc.) ---
while (heightLeft > 0) {
    doc.addPage();
    
    // This moves the "camera" up, but adds your 30mm gap at the top of the new page
    doc.addImage(imgData, 'PNG', 0, position + subsequentPageMargin, pdfWidth, pdfImgHeight);
    
    // We subtract only the "visible" area from the height remaining
    heightLeft -= effectivePageHeight;
    position -= effectivePageHeight;
}


const fileName = `${document.getElementById('fullName').value || 'Executive'}_CV.pdf`;
doc.save(fileName);






            // POST GENERATION
            if (confirm("CV Generated! Would you like a matching Executive Cover Letter?")) {
                window.location.href = "executive-coverletter.html";
            } else {
                window.location.href = "template.html";
            }
        };



window.usePowerVerbs = () => {
    let text = document.getElementById('summary').value;
    if(!text) {
        alert("Please write something first!");
        return;
    };

    const powerMap = {
        // LEADERSHIP & PEOPLE
        "led": "spearheaded", "lead": "spearhead",
        "managed": "orchestrated", "manage": "orchestrate",
        "bossed": "directed", "supervised": "governed",
        "helped": "facilitated", "help": "empower",
        "trained": "mentored", "train": "mentor",
        "hired": "recruited", "hire": "recruit",
        "fired": "restructured", "working": "collaborating",
        "watched": "monitored", "watch": "monitor",
        "team": "cross-functional unit", "people": "human capital",

        // GROWTH, REVENUE & FINANCE
        "grew": "exponentially expanded", "grow": "cultivate",
        "increased": "maximized", "increase": "maximize",
        "saved": "conserved", "save": "conserve",
        "won": "secured", "win": "secure",
        "improved": "optimized", "improve": "optimize",
        "spent": "allocated", "spend": "allocate",
        "bought": "procured", "buy": "procure",
        "sold": "monetized", "sell": "monetize",
        "got": "acquired", "get": "acquire",
        "money": "capital", "profit": "bottom-line earnings",

        // STRATEGY & INNOVATION
        "started": "pioneered", "start": "initiate",
        "made": "engineered", "make": "formulate",
        "built": "constructed", "build": "construct",
        "created": "authored", "create": "generate",
        "thought": "conceptualized", "think": "envision",
        "planned": "strategized", "plan": "strategize",
        "changed": "transformed", "change": "transform",
        "found": "identified", "find": "identify",
        "idea": "strategic initiative", "new": "innovative",

        // EXECUTION & OPERATIONS
        "did": "executed", "do": "implement",
        "worked": "navigated", "work": "function",
        "used": "leveraged", "use": "leverage",
        "fixed": "rectified", "fix": "rectify",
        "handled": "mitigated", "handle": "address",
        "kept": "sustained", "keep": "sustain",
        "met": "surpassed", "meet": "exceed",
        "finished": "finalized", "finish": "conclude",
        "organized": "systematized", "organize": "coordinate",
        "checked": "audited", "check": "verify",
        "job": "mandate", "task": "objective",

        // COMMUNICATION & AUTHORITY
        "said": "articulated", "say": "articulate",
        "wrote": "composed", "write": "author",
        "showed": "demonstrated", "show": "demonstrate",
        "talked": "negotiated", "talk": "negotiate",
        "shared": "disseminated", "share": "disseminate",
        "asked": "queried", "ask": "query",
        "gave": "presented", "give": "present",
        "explained": "clarified", "explain": "elucidate",

        // EXECUTIVE ADJECTIVES & FILLERS
        "good": "exceptional", "better": "superior",
        "big": "substantial", "small": "targeted",
        "fast": "expedited", "quick": "agile",
        "hard": "rigorous", "easy": "seamless",
        "many": "numerous", "some": "diverse",
        "a lot": "a significant volume of", "really": "decidedly",
        "successful": "high-impact", "best": "industry-leading"
    };

    let count = 0;
    Object.keys(powerMap).forEach(key => {
        // \b ensures we don't replace parts of words (e.g., 'manage' in 'management')
        const regex = new RegExp(`\\b${key}\\b`, "gi");
        const matches = text.match(regex);
        
        if(matches) {
            text = text.replace(regex, (matched) => {
                // Preserve Capitalization (e.g., 'Led' becomes 'Spearheaded')
                if (matched[0] === matched[0].toUpperCase()) {
                    const replacement = powerMap[key];
                    return replacement.charAt(0).toUpperCase() + replacement.slice(1);
                }
                return powerMap[key];
            });
            count += matches.length;
        }
    });

    if(count > 0) {
        document.getElementById('summary').value = text;
        const btn = event.target;
        const originalText = btn.innerText;
        
        btn.innerText = `ðŸš€ ${count} EXECUTIVE UPGRADES`;
        btn.style.background = "#22c55e"; 
        btn.style.color = "white";
        
        setTimeout(() => {
            btn.innerText = originalText;
            btn.style.background = "";
            btn.style.color = "";
        }, 3000);
    } else {
        alert("Your profile already utilizes high-authority language. No weak verbs detected!");
    }
};

  // Captures checkbox toggles and clicks that modify the CV structure
document.addEventListener('change', (e) => {
    if (e.target.classList.contains('cert-check') || e.target.type === 'checkbox') {
        saveToFirebase();
    }
});

        // --- PREVIEW & LIVE EDIT ENGINE ---

window.showExecutivePreview = async () => {

    // 1. First, run the existing mapping logic to fill the hidden #cvRenderArea
    // Since validateAndGenerate has the mapping logic inside it, 
    // we call it but we'll modify it to NOT download immediately.
    await prepareTemplateData();

    // 2. Clone the rendered area into the Modal
    const cvSource = document.getElementById('cvRenderArea');
    const container = document.getElementById('previewContainer');
    
    container.innerHTML = ''; // Clear previous
    const clone = cvSource.cloneNode(true);
    
    // 3. Make the clone visible and editable
    clone.id = "livePreviewCV";
    clone.style.position = "relative";
    clone.style.left = "0";
    clone.style.margin = "0";
    clone.setAttribute("contenteditable", "true"); // THIS ALLOWS TYPING ON THE CV
    
    container.appendChild(clone);
    
    // 4. Show the modal
    document.getElementById('previewModal').classList.remove('hidden');
    document.body.style.overflow = "hidden"; // Prevent background scrolling
};

window.closePreview = () => {
    document.getElementById('previewModal').classList.add('hidden');
    document.body.style.overflow = "auto";
};


window.executeFinalDownload = async () => {
    // 1. Double check access
    if (!userHasAccess) { alert("No credits left."); return; }

    try {
        // 2. Deduct 1 Credit from Firebase
        const { updateDoc, increment } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
        const userRef = doc(db, "users", auth.currentUser.uid);
        
        await updateDoc(userRef, {
            credits: increment(-1)
        });

        // 3. Proceed with download
        const editedCV = document.getElementById('livePreviewCV');
        const hiddenCV = document.getElementById('cvRenderArea');
        hiddenCV.innerHTML = editedCV.innerHTML;

        window.closePreview();
        await validateAndGenerate();
        
    } catch (e) {
        alert("Payment Error: Could not verify credit deduction.");
        console.error(e);
    }
};



// HELPER: To avoid code duplication, wrap your mapping logic into this function
async function prepareTemplateData() {
    document.getElementById('pdf-name').innerText = document.getElementById('fullName').value || "MICHAEL ANDERSON";
    document.getElementById('pdf-title').innerText = document.getElementById('jobTitle').value || "CHIEF OPERATIONS OFFICER";
    document.getElementById('pdf-contact').innerHTML = `
        <span>${document.getElementById('phone').value}</span> | 
        <span>${document.getElementById('email').value}</span> | 
        <span>${document.getElementById('linkedin').value}</span> | 
        <span>${document.getElementById('location').value}</span>
    `;
document.getElementById('pdf-summary').innerText = document.getElementById('summary').value;

// --- UPDATED CORE COMPETENCIES STYLE ---
const skillsElement = document.getElementById('pdf-skills');
skillsElement.style.display = "block";
skillsElement.style.textAlign = "center";
skillsElement.style.fontSize = "9.5pt";   // Reduced font size to match image
skillsElement.style.lineHeight = "1.6";
skillsElement.style.fontWeight = "400";   // Normal weight for the list
skillsElement.style.color = "#444";       // Professional dark grey
skillsElement.innerHTML = window.skills.join(' | '); // Horizontal pipe separation


// NEW EXPERIENCE MAPPING (SAFE VERSION)
let expHtml = "";
document.querySelectorAll('#experienceList > div').forEach(card => {
    // These lines are now "Null-Safe"
    const company = (card.querySelector('.exp-company')?.value || "").toUpperCase();
    const role = (card.querySelector('.exp-role')?.value || "").toUpperCase();
    const date = card.querySelector('.exp-date')?.value || "";
    const context = card.querySelector('.exp-context')?.value || ""; 
    const bullets = (card.querySelector('.exp-bullets')?.value || "").split('\n').filter(line => line.trim() !== "");

    expHtml += `
        <div style="margin-bottom: 20px; page-break-inside: avoid;">
            <div style="font-size: 10.5pt; color: #2c4a70; font-weight: 800; margin-bottom: 2px;">
                ${company} | ${role} | ${date}
            </div>
            
            ${context ? `<div style="font-size: 9pt; font-style: italic; color: #555; margin-bottom: 6px; padding-left: 2px;">Scope: ${context}</div>` : ''}
            
            <div style="padding-left: 5px;">
                ${bullets.map(b => `
                    <div style="display:flex; font-size: 9.5pt; margin-bottom: 4px; align-items: flex-start; line-height: 1.4;">
                        <span style="margin-right: 10px; color: #333;">â€¢</span>
                        <span style="color: #444;">${b.trim()}</span>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
});
document.getElementById('pdf-experience').innerHTML = expHtml;




// NEW HORIZONTAL EDUCATION MAPPING
let eduHtml = "";
document.querySelectorAll('#educationList > div').forEach(card => {
    // Optional chaining added here ?.
    const degree = (card.querySelector('.edu-degree')?.value || "").toUpperCase();
    const school = (card.querySelector('.edu-school')?.value || "").toUpperCase();
    const year = card.querySelector('.edu-year')?.value || "";
    
    if(degree || school) {
        eduHtml += `
            <div style="margin-bottom: 8px; line-height: 1.4; font-size: 10pt; color: #333;">
                <span style="font-weight: 800; color: #2c4a70;">${degree}</span> 
                <span> | ${school} | ${year}</span>
            </div>
        `;
    }
});
document.getElementById('pdf-education').innerHTML = eduHtml;



// --- UPDATED MAPPING FOR CERTIFICATIONS (EXECUTIVE PIPE STYLE) ---
let certsHtml = "";
window.customCerts.forEach(c => {
    // Adding the (c.name || "") check here as well
    const safeName = (c.name || "CERTIFICATE").toUpperCase();
    const safeOrg = (c.org || "INSTITUTION").toUpperCase();
    const safeYear = c.year || "";

    certsHtml += `
        <div style="margin-bottom: 8px; line-height: 1.4; font-size: 10pt; color: #333;">
            <span style="font-weight: 800; color: #2c4a70;">${safeName}</span>
            <span style="color: #444;"> | ${safeOrg} | ${safeYear}</span>
        </div>`;
});
document.getElementById('pdf-certs').innerHTML = certsHtml;


// Inside prepareTemplateData
let refHtml = "";
document.querySelectorAll('#referenceList > div').forEach(card => {
    const name = (card.querySelector('.ref-name')?.value || "").toUpperCase();
    const title = card.querySelector('.ref-title')?.value || "";
    const relation = card.querySelector('.ref-relation')?.value || "";
    const contact = card.querySelector('.ref-contact')?.value || "";

    if(name) {
        refHtml += `
            <div style="margin-bottom: 8px; line-height: 1.4; font-size: 10pt; text-align: center;">
                <span style="font-weight: 800; color: #2c4a70;">${name}</span> 
                <span style="color: #444;"> | ${title} | ${relation} | ${contact}</span>
            </div>
        `;
    }
});

// Wrap the fallback in a centered div too
document.getElementById('pdf-references').innerHTML = refHtml || 
    `<div style="text-align: center; color: #666; font-style: italic;">Available upon request</div>`;



let langHtml = "";
document.querySelectorAll('#languageList > div').forEach(card => {
    const name = (card.querySelector('.lang-name')?.value || "").toUpperCase();
    const level = card.querySelector('.lang-level')?.value || "";

    if(name) {
        // We use a span or inline-block div to allow them to sit side-by-side
        langHtml += `
            <div style="display: inline-block; margin: 0 15px 5px 15px; font-size: 10pt;">
                <span style="font-weight: 800; color: #2c4a70;">${name}</span> 
                <span style="color: #666; font-size: 8.5pt;"> | ${level}</span>
            </div>
        `;
    }
});

// Target the container and ensure it centers the contents
const langContainer = document.getElementById('pdf-languages');
langContainer.style.textAlign = "center"; // Centers the languages under the header
langContainer.style.marginTop = "10px";
langContainer.innerHTML = langHtml;



}

    
    </script>

    <div id="previewModal" class="fixed inset-0 bg-black/95 z-[100] hidden overflow-y-auto p-4 md:p-10">
    <div class="max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h2 class="text-2xl font-black text-white uppercase tracking-tighter">Executive Review</h2>
                <p class="text-slate-400 text-xs">Direct Editing Enabled: Click any text on the CV to make final manual adjustments.</p>
            </div>
            <div class="flex gap-4">
                <button onclick="window.closePreview()" class="px-6 py-3 bg-white/10 text-white rounded-xl font-bold hover:bg-white/20 transition">CANCEL</button>
                <button onclick="window.executeFinalDownload()" class="px-8 py-3 premium-gradient text-white rounded-xl font-bold shadow-lg hover:scale-105 transition">DOWNLOAD PDF</button>
            </div>
        </div>
        <div id="previewContainer" class="flex justify-center bg-white p-2 md:p-0 rounded-lg overflow-hidden shadow-2xl">
        </div>
    </div>
</div>

</body>
</html>

